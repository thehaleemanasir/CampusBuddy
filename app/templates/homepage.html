<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Buddy - Homepage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">

    <style>
body.light-mode .hero h1 {
  color: white;
}

body.light-mode section
{
    background-color: white;
}
body.light-mode .hero p {
  color: white;
}

body.light-mode section h2 {
  color: rgba(128, 100, 0, 0.79);
}

body.light-mode section ul li {
  color: white;

            margin: 15px auto;
            max-width: 600px;
            background: rgba(128, 100, 0, 0.79);
            padding: 15px;
            border-radius: 10px;
            transition: transform 0.3s;
}

body.light-mode .btn-close {
  filter: invert(1);
}

        body {
            background: #1b1818;
            font-family: 'Arial', sans-serif;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        .hero {
            background-color: #1b1818;
            padding: 40px 20px;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            text-align: start;
            gap: 40px;
        }
        .hero img {
            width: 340px;
            height: 340px;
        }
        .hero h1 {
            font-size: 3rem;
            color: rgba(255, 215, 0, 0.95);
            animation: fadeInDown 1.2s ease-out;
        }
        .hero p {
            font-size: 1.3rem;
            color: #eee;
            max-width: 600px;
            margin-top: 10px;
            animation: fadeInUp 1.5s ease-out;
        }

        section {
            padding: 50px 20px;
            text-align: center;
            background-color: #2c2c2c;
        }
        section h2 {
            color: rgba(255, 215, 0, 0.9);
            margin-bottom: 20px;
        }
        section ul {
            list-style: none;
            padding: 0;
        }
        section ul li {
            margin: 15px auto;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            transition: transform 0.3s;
        }
        section ul li:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.1);
        }
        section ul li a {
            color: #fff;
            text-decoration: none;
            font-size: 1.1rem;
        }


            footer {
            background-color: #1c1c1c;
            color: white;
            padding: 2rem 0;
            text-align: center;
        }
    footer a {
            color: white;
            margin: 0 0.5rem;
        }
        @keyframes fadeInDown {
            0% { opacity: 0; transform: translateY(-30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }


  #reminderPanel.d-none {
    display: none !important;
  }

    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark shadow-sm px-4" style="background-color: #232222; border-bottom: 2px solid gold;">
  <div class="container-fluid">

    <a class="navbar-brand" href="{{ url_for('home.homepage') }}">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="TUS Logo" style="height: 175px; width: 300px;">
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
      aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-between" id="navbarContent">
      <ul class="navbar-nav mx-auto mb-2 mb-lg-0 gap-3">
        <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('home.homepage') }}">Home</a></li>
          <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('home.about') }}">About</a></li>
          <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('chatbot.chatbot') }}">Chatbot</a></li>
          <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('canteen.canteen_menu') }}">Canteen Menu</a></li>
        <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('society.societies_list') }}">Society & Clubs</a></li>
        <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('home.academic_support') }}">Academic Support</a></li>
        <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('home.mental_health') }}">Mental Health</a></li>
        <li class="nav-item"><a class="nav-link text-white fw-bold" href="{{ url_for('calendar.calendar') }}">Calendar</a></li>
      </ul>

      <div class="d-flex align-items-center gap-3 mt-3 mt-lg-0">
        <div class="position-relative" style="cursor: pointer;" onclick="toggleReminderPanel()">
          <i class="fas fa-bell fa-lg text-white"></i>
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                id="reminder-count" style="font-size: 0.75rem;">0</span>
        </div>

        {% if session['user_id'] %}
        <div class="dropdown">
          <a class="nav-link dropdown-toggle text-white fw-bold" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            ðŸ‘¤ {{ session['user_name'] }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" style="background-color: #16213E;">
            <li><a class="dropdown-item text-light" href="{{ url_for('profile.view_profile') }}"><i class="fas fa-user"></i> View Profile</a></li>
            <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
          </ul>
        </div>
        {% else %}
        <a class="btn btn-outline-light btn-sm" href="{{ url_for('auth.login') }}">Login</a>
        <a class="btn btn-warning btn-sm" href="{{ url_for('auth.register') }}">Register</a>
        {% endif %}

    <button id="modeToggle" class="btn btn-sm btn-outline-light ms-3" title="Toggle dark/light mode">
  <i class="fas fa-moon"></i>
</button>

      </div>
    </div>
  </div>
</nav>

    <div id="reminderPanel" class="position-fixed top-0 end-0 p-3 d-none" style="z-index: 9999;">
  <div class="toast show bg-light border shadow-sm" id="reminderToast" data-bs-autohide="false">
    <div class="toast-header">
      <strong class="me-auto">ðŸ”” Reminders</strong>
      <button class="btn-close" onclick="toggleReminderPanel()"></button>
    </div>
    <div class="toast-body" id="reminder-body">Loading reminders...</div>
  </div>
</div>
<audio id="reminderSound" src="{{ url_for('static', filename='audio/notify.mp3') }}"></audio>

    <div class="hero">
        <img src="{{ url_for('static', filename='images/typing-bubble.gif') }}" alt="Typing Bot Bubble">
        <div>
            <h1>Welcome to Campus Buddy!</h1>
            <p>Your one-stop solution for campus navigation, events, support & more â€” now smarter with AI.</p>
        </div>

    </div>

    <section>
        <h2>Explore Campus Buddy</h2>
        <ul>
            <li><a href="{{ url_for('society.societies_list') }}">Find Societies & Clubs</a></li>
            <li><a href="{{ url_for('home.academic_support') }}">Get Academic Support</a></li>
            <li><a href="{{ url_for('home.mental_health') }}">Access Wellness Resources</a></li>
        </ul>
    </section>

<footer>
    <a href="https://www.linkedin.com/school/tus-ie/?originalSubdomain=ie"><i class="fab fa-linkedin"></i></a>
    <a href="https://www.tiktok.com/@tus_ie?is_from_webapp=1&sender_device=pc"><i class="fab fa-tiktok"></i></a>
    <a href="https://www.instagram.com/tus_ire/"><i class="fab fa-instagram"></i></a>
    <a href="https://www.facebook.com/TUoftheShannon"><i class="fab fa-facebook"></i></a>
    <a href="https://www.youtube.com/channel/UCk_JmKG2Ghn9ZIMcb6xqAWg"><i class="fab fa-youtube"></i></a>
    <p class="mt-3">&copy; 2025 Campus Buddy. All rights reserved.</p>

</footer>

<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
<script>
    const socket = io();
const toggleBtn = document.getElementById('modeToggle');
  const body = document.body;

  window.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
      body.classList.add('light-mode');
    }
  });

  toggleBtn.addEventListener('click', () => {
    body.classList.toggle('light-mode');
    localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
  });

 let lastReminders = [];

function toggleReminderPanel() {
  const panel = document.getElementById("reminderPanel");
  panel.classList.toggle("d-none");
}

function fetchReminders() {
  fetch("/calendar/reminders")
    .then(res => res.json())
    .then(data => {
      const body = document.getElementById("reminder-body");
      const badge = document.getElementById("reminder-count");

      const currentIds = data.reminders.map(r => r.id).join(',');
      const lastIds = lastReminders.map(r => r.id).join(',');
      const isNew = currentIds !== lastIds;

      badge.textContent = data.reminders.length;
      badge.style.display = data.reminders.length ? "inline-block" : "none";

      if (!data.reminders.length) {
        body.innerHTML = "<i>No upcoming events.</i>";
      } else {
        body.innerHTML = data.reminders.map((r, i) => `
          <div class="d-flex justify-content-between align-items-center my-2">
            <div>${r.message}</div>
            <div>
              <button class="btn btn-sm btn-outline-secondary" onclick="snoozeReminder(${i})">Snooze</button>
              <button class="btn btn-sm btn-outline-danger" onclick="dismissReminder(${i})">Dismiss</button>
            </div>
          </div>
        `).join('');

        if (isNew) {
          document.getElementById('reminderSound').play();
        }
      }

      lastReminders = data.reminders;
    });
}


socket.on('new_event', data => {
  fetchReminders();
  document.getElementById("reminderPanel").classList.remove("d-none");
  try {
    document.getElementById('reminderSound').play();
  } catch (e) {}
});

function dismissReminder(index) {
  const reminder = lastReminders[index];
  fetch(`/calendar/dismiss/${reminder.id}`, { method: "POST" })
    .then(() => fetchReminders());
}

function snoozeReminder(index) {
  const reminder = lastReminders[index];
  fetch(`/calendar/snooze/${reminder.id}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ minutes: 5 })
  }).then(() => fetchReminders());
}

fetchReminders();
setInterval(fetchReminders, 60000);

document.body.addEventListener('click', () => {
  const audio = document.getElementById('reminderSound');
  audio.play().catch(() => {});
}, { once: true });

document.addEventListener("DOMContentLoaded", function() {
  const chatToggle = document.getElementById('chatToggle');
  const chatPopup = document.getElementById('chatPopup');

  if (chatToggle && chatPopup) {
    chatToggle.addEventListener('click', function() {
      if (chatPopup.style.display === "none" || chatPopup.style.display === "") {
        chatPopup.style.display = "block";
      } else {
        chatPopup.style.display = "none";
      }
    });
  }
});




</script>


<button id="chatToggle" title="Chat with Campus Buddy" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  background-color: #FFD700;
  color: #0A2342;
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  font-size: 24px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
">
  <i class="fas fa-comments"></i>
</button>

<a href="{{ url_for('chatbot.chatbot') }}" id="chatButton" title="Chat with Campus Buddy" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  background-color: #FFD700;
  color: #0A2342;
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  font-size: 24px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  display: flex;
  justify-content: center;
  align-items: center;
  text-decoration: none;
">
  <i class="fas fa-comments"></i>
</a>

</body>
</html>
